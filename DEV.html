<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NOVA DOS — v1.0</title>
<style>
:root{--bg:#000;--fg:#33ff66;--muted:#7fbf8f;--accent:#39b6ff;--panel:#071018}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:ui-monospace,SFMono-Regular,Consolas,monaco,monospace}
.container{display:flex;flex-direction:column;height:100vh}
.topbar{display:flex;align-items:center;gap:12px;padding:10px;border-bottom:1px solid rgba(255,255,255,0.03);background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent)}
.brand{font-weight:700}
.view{flex:1;display:flex;gap:12px;padding:14px}
.left{flex:1;display:flex;flex-direction:column}
.dos{flex:1;padding:12px;background:#000;border-radius:6px;box-shadow:inset 0 0 40px rgba(0,0,0,0.6);overflow:auto;border:2px solid rgba(0,255,102,0.06)}
.line{white-space:pre-wrap;font-family:inherit}
.prompt{display:flex;gap:8px;align-items:center;margin-top:8px}
.input{flex:1;background:transparent;border:0;outline:none;color:var(--fg);font-family:inherit;font-size:14px}
.cursor{width:8px;height:16px;background:var(--fg);display:inline-block;animation:blink 1s steps(2,start) infinite}
@keyframes blink{50%{opacity:0}}
.side{width:320px;min-width:260px}
.panel{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px}
.h1{font-weight:700;margin:0 0 8px 0}
.kv{color:var(--muted);font-size:13px}
.btn{padding:6px 8px;border-radius:6px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);cursor:pointer;color:var(--fg)}
.small{font-size:13px}
/* CRT effect */
.crt::before{content:"";position:absolute;left:0;right:0;top:0;bottom:0;pointer-events:none;background-image:linear-gradient(rgba(0,0,0,0) 50%, rgba(0,0,0,0.06) 50%);background-size:100% 2px;mix-blend-mode:multiply}
.scanline{background:linear-gradient(180deg, rgba(0,0,0,0) 60%, rgba(0,0,0,0.08) 100%)}
/* themes */
.theme-light{--bg:#f6f8fb;--fg:#052028;--muted:#3b5870}
.theme-crt{--bg:#000;--fg:#6bff6b}
/* responsive */
@media (max-width:820px){.view{flex-direction:column}.side{width:100%;min-width:unset}}
/* boot overlay */
.boot{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#000;color:var(--fg);z-index:50;flex-direction:column}
.boot .box{max-width:780px;padding:18px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);text-align:left}
.boot .title{font-weight:800;font-size:18px;margin-bottom:8px}
.log-small{font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<div class="container" id="app">
  <div class="topbar">
    <div class="brand">NOVA DOS</div>
    <div class="kv">v1.0 — MS‑DOS-inspired shell for NOVA (Fake/hypershell)</div>
    <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
      <button class="btn" id="rebootBtn">Reboot</button>
      <button class="btn" id="saveBtn">Save FS</button>
      <button class="btn" id="loadBtn">Load FS</button>
    </div>
  </div>
  <div class="view">
    <div class="left">
      <div class="dos" id="dos" tabindex="0"></div>
      <div class="prompt">
        <div class="kv" id="cwdLabel">C:\&gt;</div>
        <input id="cmdInput" class="input" autocomplete="off" spellcheck="false" placeholder="Type a command. 'help' for list" />
        <div class="cursor"></div>
      </div>
    </div>
    <div class="side">
      <div class="panel">
        <div class="h1">File system</div>
        <div id="fsTree" style="font-family:monospace;white-space:pre-wrap;max-height:220px;overflow:auto"></div>
        <div style="margin-top:8px;display:flex;gap:6px">
          <button class="btn" id="resetFs">Reset FS</button>
          <button class="btn" id="editStartup">Edit startup.bat</button>
        </div>
      </div>
      <div class="panel" style="margin-top:12px">
        <div class="h1">System</div>
        <div id="sysInfo" class="small kv"></div>
        <div style="margin-top:8px;display:flex;gap:6px;flex-wrap:wrap">
          <button class="btn" id="themeBtn">Toggle Theme</button>
          <button class="btn" id="crtBtn">Toggle CRT</button>
          <button class="btn" id="logoBtn">Swap Logo</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="boot" id="bootScreen">
  <div class="box">
    <div class="title">NOVA DOS 1.0</div>
    <div class="log-small">(C) NOVA Corporation 2025</div>
    <div style="height:12px"></div>
    <div id="bootLines" class="log-small"></div>
    <div style="height:12px"></div>
    <div class="kv">Press any key to skip.</div>
  </div>
</div>

<script>
/* Nova DOS — single file
 Features:
  - DOS-like UI + boot screen
  - Commands: DIR, CLS, CD, TYPE, COPY, DEL, RENAME, COLOR, EDIT, RUN, HELP, SYSINFO, UNLOCK, BREACH, INSTALL, THEME, CRT, SAVE/LOAD FS, DOWNLOAD LOG
  - Fake 'hacking' commands that trigger visual effects only (no real hacking)
  - Simple filesystem stored in JS and localStorage
  - EDIT supports a simple line-editor
  - BATCH files (.BAT) run line-by-line; startup.bat runs on boot
*/

const dos = document.getElementById('dos');
const input = document.getElementById('cmdInput');
const cwdLabel = document.getElementById('cwdLabel');
const fsTree = document.getElementById('fsTree');
const sysInfo = document.getElementById('sysInfo');
const bootScreen = document.getElementById('bootScreen');
const bootLines = document.getElementById('bootLines');

let theme = 0; // 0=green,1=light
let crt = false;
let logoSwap = false;
let adminUnlocked = false;

const defaultFS = {
  'C:': {
    'AUTOEXEC.BAT': 'ECHO Starting NOVA DOS...\nRUN STARTUP.BAT\n',
    'STARTUP.BAT': 'ECHO Welcome to NOVA DOS\nTHEME CRT\n',
    'README.TXT': 'Welcome to NOVA DOS. Type HELP for commands.\n',
    'SYSTEM': {
      'CONFIG.INI': 'owner=NOVA',
    },
    'APPS': {
      'FALCON.DRV': 'DRIVER: FALCON - fake driver file for demo',
    }
  }
};

// load from localStorage
function loadFS(){
  try{
    const raw = localStorage.getItem('nova_dos_fs');
    if(raw){ fs = JSON.parse(raw); appendLine('Loaded filesystem from storage.'); return; }
  }catch(e){ console.error(e); }
  fs = JSON.parse(JSON.stringify(defaultFS));
}
function saveFS(){ localStorage.setItem('nova_dos_fs', JSON.stringify(fs)); appendLine('Filesystem saved.'); }

let fs = {};
loadFS();

function renderTree(){
  function walk(node,path,indent=0){
    let out='';
    Object.keys(node).forEach(k=>{
      const v=node[k];
      if(typeof v === 'string') out += ' '.repeat(indent)+k+'\n';
      else out += ' '.repeat(indent)+k+'\\\n'+walk(v,path+'/'+k,indent+2);
    });
    return out;
  }
  fsTree.textContent = walk(fs['C:'],'C:');
}

function appendLine(text,cls){
  const div = document.createElement('div'); div.className='line'; div.textContent = text; dos.appendChild(div); dos.scrollTop = dos.scrollHeight;
}

function clearScreen(){ dos.innerHTML=''; }

// basic path resolver
function resolve(path){
  // support C:\DIR\FILE or relative filenames
  if(!path) return {node:fs['C:'],name:null};
  const p = path.replace(/^c:\\?/i,'').split('\\').filter(Boolean).map(s=>s.toUpperCase());
  let node = fs['C:'];
  for(let i=0;i<p.length;i++){
    const part = p[i];
    if(node[part]===undefined) return null;
    node = node[part];
  }
  return {node};
}

// commands
const commands = {
  HELP(){
    return `Commands:\nHELP DIR CLS CD TYPE COPY DEL RENAME EDIT RUN SAVE LOAD INSTALL THEME CRT SYSINFO UNLOCK BREACH COLOR\nAlso: STARTUP.BAT will run on boot. Use EDIT to create .BAT scripts.`;
  },
  DIR(){
    const node = fs['C:'];
    return Object.keys(node).map(k=> (typeof node[k]==='string')?k+'':k+'\\').join('\n');
  },
  CLS(){ clearScreen(); return ''; },
  TYPE(args){
    if(!args[0]) return 'TYPE: missing filename';
    const res = resolve(args[0]); if(!res) return 'TYPE: file not found';
    if(typeof res.node === 'string') return res.node; return 'TYPE: is a directory';
  },
  CD(args){
    // fake: only root C:\ supported, but allow CD ..
    return 'CD: only C:\\ is supported in this demo';
  },
  COPY(args){
    if(args.length<2) return 'COPY: need source and dest';
    const src = resolve(args[0]); if(!src || typeof src.node !=='string') return 'COPY: source missing or not a file';
    // write to dest
    const destParts = args[1].replace(/^c:\\?/i,'').split('\\').filter(Boolean);
    let node = fs['C:']; for(let i=0;i<destParts.length-1;i++){ const p = destParts[i].toUpperCase(); if(!node[p]||typeof node[p]==='string') node[p]={}; node=node[p]; }
    const name = destParts[destParts.length-1].toUpperCase(); node[name] = src.node; return `Copied to ${args[1]}`;
  },
  DEL(args){
    if(!args[0]) return 'DEL: missing file';
    const parts = args[0].replace(/^c:\\?/i,'').split('\\').filter(Boolean).map(s=>s.toUpperCase());
    let node = fs['C:']; for(let i=0;i<parts.length-1;i++){ if(!node[parts[i]]) return 'DEL: not found'; node = node[parts[i]]; }
    const nm = parts[parts.length-1]; if(node[nm]===undefined) return 'DEL: not found'; delete node[nm]; return 'Deleted '+args[0];
  },
  RENAME(args){
    if(args.length<2) return 'RENAME: need old and new name';
    // naive: same folder only
    const parts = args[0].replace(/^c:\\?/i,'').split('\\').filter(Boolean).map(s=>s.toUpperCase());
    let node = fs['C:']; for(let i=0;i<parts.length-1;i++){ if(!node[parts[i]]) return 'RENAME: not found'; node = node[parts[i]]; }
    const oldName = parts[parts.length-1]; const newName = args[1].toUpperCase(); if(!node[oldName]) return 'RENAME: not found'; node[newName]=node[oldName]; delete node[oldName]; return 'Renamed';
  },
  EDIT(args){
    // open a simple line editor modal
    const name = args[0]; if(!name) return 'EDIT: missing filename';
    openEditor(name); return '';
  },
  RUN(args){
    if(!args[0]) return 'RUN: missing filename';
    const name = args[0].toUpperCase(); const res = resolve(name); if(!res) return 'RUN: not found';
    if(typeof res.node !== 'string') return 'RUN: is a directory';
    // run line by line
    runBatch(res.node); return '';
  },
  SAVE(){ saveFS(); return ''; },
  LOAD(){ loadFS(); renderTree(); return ''; },
  INSTALL(args){
    // fake install: if installing FALCON.DRV, enable a special effect
    const pkg = args[0] ? args[0].toUpperCase() : ''; if(pkg==='FALCON.DRV'){ appendLine('Installing FALCON driver...'); setTimeout(()=>{ appendLine('FALCON installed. Use RUN FALCON to activate.'); },600); return ''; }
    return 'INSTALL: unknown package';
  },
  THEME(args){
    if(!args[0]) return 'THEME: current '+(theme===0?'green-on-black':'light');
    const t = args[0].toUpperCase(); if(t==='LIGHT'){ document.documentElement.classList.add('theme-light'); theme=1; return 'Theme set to light'; }
    if(t==='GREEN' || t==='CRT'){ document.documentElement.classList.remove('theme-light'); theme=0; return 'Theme set to green'; }
    return 'THEME: unknown';
  },
  CRT(){ toggleCRT(); return 'CRT toggled'; },
  SYSINFO(){ return `NOVA DOS v1.0\nFake CPU: 1337 MHz\nMemory: 128MB (sim)\nAdmin: ${adminUnlocked?'YES':'NO'}`; },
  UNLOCK(args){
    // UNLOCK ADMIN <password>
    if(args[0] && args[0].toUpperCase()==='ADMIN' && args[1]){
      if(args[1]==='novaadmin'){ adminUnlocked=true; return 'ADMIN unlocked'; }
      return 'UNLOCK: wrong key';
    }
    return "Usage: UNLOCK ADMIN <key>";
  },
  BREACH(){ appendLine('BREACH: initiating simulated exploit...'); appendLine('...this is fake — only effects inside NOVA DOS'); setTimeout(()=>{ appendLine('BREACH complete: debug UI unlocked'); adminUnlocked=true; },1000); return ''; },
  COLOR(args){
    // COLOR uses DOS hex codes; here we use simple mapping
    if(!args[0]) return 'COLOR: missing';
    if(args[0]==='0A'){ document.documentElement.style.setProperty('--fg','#33ff66'); return 'Color set'; }
    if(args[0]==='0C'){ document.documentElement.style.setProperty('--fg','#ff6666'); return 'Color set'; }
    return 'COLOR: code not supported in demo';
  },
  DOWNLOADLOG(){
    const blob = new Blob([dos.innerText],{type:'text/plain'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='novados-log.txt'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); return 'Download started';
  }
};

function runBatch(script){
  const lines = script.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  (async()=>{
    for(const l of lines){
      appendLine('> '+l); await new Promise(r=>setTimeout(r,200));
      await handleCommand(l);
    }
  })();
}

async function handleCommand(raw){
  if(!raw) return;
  const parts = raw.trim().split(/\s+/);
  const cmd = parts[0].toUpperCase(); const args = parts.slice(1);
  if(commands[cmd]){
    try{ const out = commands[cmd](args); if(out) appendLine(out); renderTree(); }
    catch(e){ appendLine('ERROR: '+e.message); }
  } else {
    appendLine(`${cmd}: command not found`);
  }
}

// editor
function openEditor(filename){
  const fname = filename.toUpperCase();
  const existing = resolve(fname);
  const initial = existing && typeof existing.node==='string' ? existing.node : '';
  const text = prompt(`EDIT ${filename} — simple editor (\n for new lines).`, initial.replace(/\\n/g,'\n'));
  if(text===null) { appendLine('Edit cancelled'); return; }
  // write into FS
  const parts = fname.replace(/^C:\\?/,'').split('\\').filter(Boolean);
  let node = fs['C:']; for(let i=0;i<parts.length-1;i++){ const p=parts[i].toUpperCase(); if(!node[p]||typeof node[p]==='string') node[p]={}; node=node[p]; }
  node[parts[parts.length-1]] = text.replace(/\r/g,''); appendLine('Saved '+filename); renderTree();
}

// input handling
let history = []; let hpos = 0;
input.addEventListener('keydown',(e)=>{
  if(e.key==='Enter'){ const v=input.value; history.push(v); hpos=history.length; appendLine('C:\>'+v); handleCommand(v); input.value=''; e.preventDefault(); }
  else if(e.key==='ArrowUp'){ hpos=Math.max(0,hpos-1); input.value=history[hpos]||''; e.preventDefault(); }
  else if(e.key==='ArrowDown'){ hpos=Math.min(history.length,hpos+1); input.value=history[hpos]||''; e.preventDefault(); }
  else if(e.key==='Tab'){ e.preventDefault(); autocomplete(); }
});

function autocomplete(){ const v=input.value.trim().toUpperCase(); if(!v) return; const matches = Object.keys(commands).filter(c=>c.startsWith(v)); if(matches.length===1) input.value = matches[0]+' '; else if(matches.length>1) appendLine('Possible: '+matches.join(', ')); }

// UI toggles
function toggleTheme(){ if(theme===0){ document.documentElement.classList.add('theme-light'); theme=1; appendLine('Theme: light'); } else { document.documentElement.classList.remove('theme-light'); theme=0; appendLine('Theme: green'); } }
function toggleCRT(){ crt = !crt; if(crt) document.documentElement.classList.add('theme-crt'); else document.documentElement.classList.remove('theme-crt'); appendLine('CRT '+(crt?'enabled':'disabled')); }
function toggleLogo(){ logoSwap = !logoSwap; appendLine('Logo '+(logoSwap?'swapped':'restored')); }

function setSysInfo(){ sysInfo.textContent = `User: guest\nTheme: ${theme===0?'green':'light'}\nCRT: ${crt}\nAdmin: ${adminUnlocked}`; }

// buttons
document.getElementById('rebootBtn').addEventListener('click', ()=>{ boot(true); });
document.getElementById('saveBtn').addEventListener('click', ()=>{ saveFS(); });
document.getElementById('loadBtn').addEventListener('click', ()=>{ loadFS(); renderTree(); appendLine('Filesystem loaded'); });
document.getElementById('resetFs').addEventListener('click', ()=>{ if(confirm('Reset filesystem to defaults?')){ fs = JSON.parse(JSON.stringify(defaultFS)); saveFS(); renderTree(); appendLine('Filesystem reset'); } });
document.getElementById('editStartup').addEventListener('click', ()=>{ openEditor('STARTUP.BAT'); });
document.getElementById('themeBtn').addEventListener('click', ()=>{ toggleTheme(); setSysInfo(); });
document.getElementById('crtBtn').addEventListener('click', ()=>{ toggleCRT(); setSysInfo(); });
document.getElementById('logoBtn').addEventListener('click', ()=>{ toggleLogo(); setSysInfo(); });

// boot sequence
function boot(skip=false){
  bootScreen.style.display='flex';
  dos.innerHTML='';
  let steps = [
    'POST: CPU OK',
    'Memory test: 128MB OK',
    'Mounting virtual drives...',
    'Loading AUTOEXEC.BAT',
    'Starting shell...'
  ];
  bootLines.innerHTML='';
  let i=0;
  const t = setInterval(()=>{
    if(i>=steps.length || skip){ clearInterval(t); bootScreen.style.display='none'; startup(); return; }
    bootLines.innerHTML += steps[i] + '<br/>'; i++; },500);
}

function startup(){ appendLine('NOVA DOS booted. Type HELP for commands.'); // run startup
  const auto = fs['C:']['STARTUP.BAT']; if(auto) runBatch(auto); renderTree(); setSysInfo(); input.focus(); }

// start
renderTree(); boot(false);

// safety: make sure all hacking commands are purely cosmetic
// We will not execute any external code, open sockets, or change files outside localStorage. All "install" and "breach" commands only alter in-app state.

</script>
</body>
<script>
// --- Simple Admin Unlock Command ---
// Usage: Type: ADMIN 2012
// When correct, sets adminMode = true and displays message

(function(){
  window.NOVA_ADMIN = false; // global admin flag

  // hook into existing command handler
  if (typeof handleCommand === 'function') {
    const original = handleCommand;
    window.handleCommand = function(cmd) {
      const upper = cmd.trim().toUpperCase();

      if (upper === "ADMIN 2012") {
        window.NOVA_ADMIN = true;
        printToTerminal("[ACCESS GRANTED] Admin mode unlocked.");
        return;
      }

      return original(cmd);
    };
  } else {
    console.warn("NOVA DOS: handleCommand() not found. Add this after the command system.");
  }
})();
</script>
</html>
